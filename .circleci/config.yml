version: 2.1
jobs:  
  deploy:
    docker:
      - image: 'cimg/ruby:2.6.6-node'
    steps:
      - checkout
      - run:
          name: apt install
          command: |
            apt-get update \
                && apt-get install -y --no-install-recommends \
                    build-essential \
                    git \
                && npm install -g widdershins    \
                && gem install bundler -v 2.4.22 \
                && bundle install 
      - run:
          name: add permission
          command: chmod +x deploy.sh
      - run:
          name: deploy slate
          command: ./deploy.sh --gen-widdershins

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - deploy:
          name: deploy slate
          filters:
            branches:
              only:
                - deployCircleCi
