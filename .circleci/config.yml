version: 2.1
jobs:  
  deploy:
    docker:
      - image: 'cimg/ruby:2.6.6-node'
    steps:
      - checkout
      - run:
          name: apt install
          command: |
            apk update \
            && apk upgrade --no-cache \
            && apk add --no-cache --repository http://dl-cdn.alpinelinux.org/alpine/v3.14/main/ nodejs=14.20.0-r0 npm \
            && apk add git \
            && apk add --no-cache build-base
      - run:
          name: install widdershins
          command: npm install -g widdershins && gem install bundler

      - run:
          name: add permission
          command: chmod +x deploy.sh
      - run:
          name: deploy slate
          command: ./deploy.sh --gen-widdershins

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - deploy:
          name: deploy slate
          filters:
            branches:
              only:
                - deployCircleCi
