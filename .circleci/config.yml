version: 2.1
jobs:  
  deploy:
    docker:
      - image: 'cimg/ruby:2.6.1'
    steps:
      - checkout
      - run:
          name: apt install
          command: |
            apt-get update \
                && apt-get install -y --no-install-recommends \
                    build-essential \
                    git \
                    nodejs \
                && gem install bundler -v 2.4.22\
                && bundle install \
                && apt-get remove -y build-essential git \
                && apt-get autoremove -y \
                && rm -rf /var/lib/apt/lists/*
      - run:
          name: install widdershins
          command: npm install -g widdershins
      - run:
          name: add permission
          command: chmod +x deploy.sh
      - run:
          name: deploy slate
          command: ./deploy.sh --gen-widdershins

workflows:
  version: 2
  build-and-deploy:
    jobs:
      - deploy:
          name: deploy slate
          filters:
            branches:
              only:
                - deployCircleCi
