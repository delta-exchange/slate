# Authentication

Api endpoints that place orders or fetch account related information needs to authenticated using api key and api secret.

**Note**
You should use ntp timestamp to sync local clocks inorder to avoid following issue:

```{ "error: "SignatureExpired", message:"your signature has expired" }```

## Generating an API Key

Before being able to sign any requests, you must create an API key via the Delta website. Upon creating a key you will receive api key and api secret, which you must remember and secure at your end. The Key and Secret will be randomly generated.

You can create a new API key from here :
[https://www.delta.exchange/app/account/manageapikeys](https://www.delta.exchange/app/account/manageapikeys)

## API Key Permissions

You can restrict the functionality of API keys. Before creating the key, you must choose what permissions you would like the key to have. The permissions are:

- Trading - Allow a key to have trading permissions. This includes placing new orders, cancelling orders, closing positions, changing margin & leverage.
- Withdrawals - Allows a key to transfer assets/cryptocurrencies on behalf of an account, including deposits and withdraws. Enable with caution - API key transfers WILL BYPASS two-factor authentication.

## Creating a Request

All Authenticated requests must contain the following headers:

**api-key**: The api key as a string.

**signature**: The hex-encoded signature (see [Signing a Message](https://docs.delta.exchange/#signing-a-message)).

**timestamp**: A timestamp for your request.


All request bodies should have content type application/json and be valid JSON.

## Signing a Message

The signature header is generated by creating a sha256 HMAC using **the secret key on the prehash string method + timestamp + requestPath + query params + body (where + represents string concatenation)** and convert output to hexdigest. The timestamp value is the same as the 'timestamp' header.

> Code samples

```shell

# GET /orders
# queryString: product_id=1&state=open

# Generating signature:
echo -n "GET1542110948/orders?product_id=1&state=open" | openssl dgst -sha256 -hmac "7b6f39dcf660ec1c7c664f612c60410a2bd0c258416b498bf0311f94228f"

# Sample Request:
# Url:
#  /orders?product_id=1&state=open
# Headers:
#  signature: ad767fead0bdbe91ba1e4feb142079245fecd66aa5e47a70b40ba1a4c9b4e3db
#  api-key: a207900b7693435a8fa9230a38195d
  #timestamp: 1542110948

```

```python
import hashlib
import hmac
import base64
import requests

api_key = 'a207900b7693435a8fa9230a38195d'
api_secret = '7b6f39dcf660ec1c7c664f612c60410a2bd0c258416b498bf0311f94228f'

def generate_signature(secret, message):
    message = bytes(message, 'utf-8')
    secret = bytes(secret, 'utf-8')
    hash = hmac.new(secret, message, hashlib.sha256)
    return hash.hexdigest()

def get_time_stamp():
    d = datetime.datetime.utcnow()
    epoch = datetime.datetime(1970,1,1)
    return str(int((d - epoch).total_seconds()))

# Get open orders
method = 'GET'
timestamp = get_time_stamp()
path = '/orders'
query = '?product_id=1&state=open'
signature_data = method + timestamp + path + query + payload
signature = generate_signature(api_secret, signature_data)
req_headers = {
  'api-key': api_key,
  'timestamp': timestamp,
  'signature': signature,
  'User-Agent': 'rest-client',
  'Content-Type': 'application/json'
}

# Place new order
method = 'POST'
timestamp = get_time_stamp()
path = '/orders'
query = ''
payload = "{\"order_type\":\"limit_order\",\"size\":3,\"side\":\"buy\",\"limit_price\":\"0.0005\",\"product_id\":1}"

signature = generate_signature(api_secret, signature_data)
req_headers = {
  'api-key': api_key,
  'timestamp': timestamp,
  'signature': signature,
  'User-Agent': 'rest-client',
  'Content-Type': 'application/json'
}

```
